---
import { type Document, type EntryWithConfig } from "@openuji/speculator";
import { loadDocument, listSortedSpecs } from "@/utils/load";
import BlockRenderer from "@/components/BlockRenderer.astro";
import SpecLayout from "@/layouts/SpecLayout.astro";

export async function getStaticPaths() {
  const specs = await listSortedSpecs();
  console.log("specs.entries", specs.entries);
  return specs.entries.map((spec: EntryWithConfig) => ({
    params: {
      spec: spec.config.id,
    },
  }));
}

const { spec } = Astro.params;

const document: Document = await loadDocument(spec);
console.log("document", document);
---

<SpecLayout title={`${spec} - UJG Spec`} toc={document.computed?.toc || []}>
  {
    document.children.map((child) => (
      <BlockRenderer
        node={child}
        documentPath={document.sourcePos?.file}
        headingNumbers={document.computed?.headingNumbers}
      />
    ))
  }
</SpecLayout>
